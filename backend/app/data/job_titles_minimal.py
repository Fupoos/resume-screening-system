"""职位名称列表 - 仅用于字符串匹配，不包含评分逻辑

根据CLAUDE.md核心原则：
- 只用于简单的字符串匹配（从邮件标题提取职位名称）
- 不包含任何评分、判断逻辑
- 所有评分由外部Agent完成
"""

from typing import Dict, List, Pattern
import re


# 7个大类的职位名称列表（用于精确匹配）
JOB_TITLES: Dict[str, List[str]] = {
    "Java开发": [
        "Java开发工程师", "Java后端开发", "Java工程师", "Java后端工程师",
        "Java高级开发", "Java资深开发", "Java架构师",
        "Java软件工程师", "Java应用开发", "Java服务器开发",
        "Java开发", "Java后端", "Java服务端",
        "后端开发工程师", "后端工程师", "后端开发",
        "服务端开发工程师", "服务端开发",
        "Spring开发工程师", "Spring Boot开发",
        "微服务开发工程师", "分布式开发",
        "技术经理", "研发经理", "技术总监", "架构师",
        "后端架构师", "系统架构师", "软件架构师",
    ],

    "销售总监": [
        "销售总监", "销售经理", "大区经理", "区域销售总监",
        "销售部经理", "销售主管", "业务总监", "市场销售总监",
        "客户总监", "大客户经理", "客户经理", "KA经理", "销售总经理",
        "销售代表", "销售专员", "销售助理",
        "渠道销售经理", "渠道销售总监",
        "业务拓展经理", "BD经理", "商务经理",
    ],

    "自动化测试": [
        "自动化测试工程师", "测试工程师", "自动化测试", "测试开发工程师",
        "软件测试工程师", "QA工程师", "SDET", "测试开发",
        "自动化测试开发", "测试架构师", "性能测试工程师",
        "接口测试工程师", "接口测试", "API测试工程师",
        "大数据质量测试工程师", "大数据测试", "数据质量工程师",
        "性能测试", "压力测试", "负载测试",
        "功能测试工程师", "功能测试",
        "测试分析师", "QA Lead", "QA主管",
        "软件测试", "测试专员", "测试主管",
        "测试经理", "QA经理", "质量经理",
    ],

    "市场运营": [
        "市场运营", "运营经理", "市场运营专员", "运营总监",
        "市场营销", "运营策划", "品牌运营", "新媒体运营",
        "内容运营", "用户运营", "产品运营", "运营主管",
        "运营专员", "运营助理", "运营实习生",
        "用户运营经理", "用户运营专员",
        "内容运营经理", "内容运营专员",
        "活动运营", "活动策划", "活动执行",
        "品牌经理", "品牌专员", "品牌策划",
        "市场经理", "市场专员", "市场策划",
        "新媒体运营", "内容运营",
    ],

    "前端开发": [
        "前端开发工程师", "前端工程师", "前端开发", "Web前端",
        "前端架构师", "高级前端工程师", "资深前端开发",
        "H5开发", "移动端开发", "前端页面开发",
        "Web前端工程师", "网页开发", "UI开发",
        "React开发工程师", "Vue开发工程师", "Angular开发工程师",
        "小程序开发工程师", "H5开发工程师",
        "移动端前端开发", "响应式开发",
    ],

    "产品经理": [
        "产品经理", "产品专员", "产品总监", "高级产品经理",
        "资深产品经理", "产品负责人", "产品助理",
        "产品策划", "互联网产品经理", "移动产品经理",
        "产品助理", "产品实习生",
        "B端产品经理", "C端产品经理", "后台产品经理",
        "数据产品经理", "策略产品经理",
        "产品运营经理", "产品运营专员",
        "产品设计师", "产品规划师",
        "项目经理", "软件项目经理", "IT项目经理", "技术项目经理",
        "项目专员", "项目管理",
        "项目总监",
    ],

    "实施顾问": [
        "实施顾问", "实施工程师", "软件实施", "项目实施",
        "ERP实施", "CRM实施", "系统实施", "实施专员",
        "实施经理", "技术实施", "信息化实施",
        "实施助理", "实施实习生",
        "ERP实施顾问", "CRM实施顾问", "SAP实施顾问",
        "软件实施工程师", "系统实施工程师",
        "项目实施工程师", "技术实施工程师",
        "实施主管", "实施总监",
        "售前顾问", "售后顾问",
        "解决方案顾问", "技术顾问",
    ],
}


def _compile_patterns() -> Dict[str, Dict[str, List[Pattern]]]:
    """编译所有模糊匹配正则表达式

    Returns:
        {
            "职位名称": {
                "fuzzy_compiled": [pattern1, pattern2, ...]
            }
        }
    """
    compiled = {}
    for job_name, patterns in JOB_TITLES.items():
        # 将所有职位名称编译为正则表达式
        fuzzy_patterns = [re.compile(re.escape(pattern), re.IGNORECASE) for pattern in patterns]
        compiled[job_name] = {
            "fuzzy_compiled": fuzzy_patterns
        }
    return compiled


# 预编译正则表达式（模块加载时执行）
_COMPILED_PATTERNS = _compile_patterns()


def get_job_config(job_name: str) -> Dict:
    """获取职位配置

    Args:
        job_name: 职位名称

    Returns:
        职位配置字典（只包含名称和模式，不包含评分配置）
    """
    return {
        "name": job_name,
        "patterns": JOB_TITLES.get(job_name, [])
    }


def get_all_job_names() -> List[str]:
    """获取所有职位名称列表"""
    return list(JOB_TITLES.keys())


def get_compiled_patterns(job_name: str) -> List[Pattern]:
    """获取预编译的正则表达式模式

    Args:
        job_name: 职位名称

    Returns:
        编译后的正则表达式列表
    """
    return _COMPILED_PATTERNS.get(job_name, {}).get("fuzzy_compiled", [])


def is_valid_job(job_name: str) -> bool:
    """检查职位是否在定义列表中

    Args:
        job_name: 职位名称

    Returns:
        是否为有效职位
    """
    return job_name in JOB_TITLES
